import{r as i,g as Q,u as B,a as G,Q as P,j as r,R as V,b as t,C as m,F as o,c as A,B as z}from"./index.0caedde8.js";import{u as J,c as K,a as h,b as R}from"./index.esm.9ad0c25f.js";const M=i.exports.memo(()=>{var x,C,f,F,N,y,I,j,E,S,U,w,q,v,D,L;i.exports.useState(!1);const c=Q(),[H,p]=i.exports.useState(!1),{data:d}=B(`/user/list/${c==null?void 0:c.sub}`),{data:g}=B("/category/list"),e=J({initialValues:{nome:"",nif:"",fotoUrl:"",logo:"",categoriaId:"",provinciaId:(x=d==null?void 0:d.Provincia)==null?void 0:x.id},validationSchema:K({nome:h().required("Este campo \xE9 obrigat\xF3rio"),fotoUrl:R().test("isImage","Por favor selecione um arquivo de imagem v\xE1lido!",a=>a?!0:a&&["image/png","image/jpg","image/jpeg","image/gif"].includes(a.type)),logo:R().test("isImage","Por favor selecione um arquivo de imagem v\xE1lido!",a=>a?a&&["image/png","image/jpg","image/jpeg","image/gif"].includes(a.type):!0),nif:h().required("Este campo \xE9 obrigat\xF3rio"),categoriaId:h().required("Este campo \xE9 obrigat\xF3rio")}),onSubmit:async a=>{var l,T;try{p(!0);const s=new FormData,$=new FormData;$.append("file",a==null?void 0:a.logo[0]),s.append("file",a==null?void 0:a.fotoUrl[0]);const u=await b($),n=await b(s);n&&(a={...a,fotoUrl:n==null?void 0:n.id,logo:u==null?void 0:u.id},await G.post("/school/post",a)&&(P.success("Escola cadastrada com sucesso"),e.resetForm()))}catch(s){P.error((T=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:T.message)}finally{setTimeout(()=>{p(!1)},4e3)}}});async function b(a){return(await G.post("/file",a)).data}return console.log(e.errors),r(i.exports.Fragment,{children:r(V,{children:t(m,{children:[r(m.Header,{className:"d-flex justify-content-between",children:r("div",{className:"header-title",children:r("h4",{className:"card-title",children:"Cadastrar Escola"})})}),r(m.Body,{children:r(o,{onSubmit:e==null?void 0:e.handleSubmit,encType:"multipart/form-data",children:t(V,{className:"mb-3",children:[t(A,{md:"6",className:"mb-3",children:[r(o.Label,{htmlFor:"validationCustom05",children:"Nome"}),r(o.Control,{onChange:e.handleChange,name:"nome",value:e.values.nome,type:"text",id:"nome",required:!0}),((C=e==null?void 0:e.touched)==null?void 0:C.nome)&&((f=e==null?void 0:e.errors)==null?void 0:f.nome)?r("label",{className:"mt-1 text-danger",children:(F=e==null?void 0:e.errors)==null?void 0:F.nome}):null,r(o.Label,{htmlFor:"validationCustom05",children:"Categoria"}),t(o.Select,{id:"categoriaId",name:"categoriaId",required:!0,onChange:e.handleChange,children:[r("option",{defaultChecked:!0,children:"Selecione um Categoria"}),g==null?void 0:g.map(a=>r("option",{value:a==null?void 0:a.id,children:a==null?void 0:a.nome},a==null?void 0:a.id))]}),((N=e==null?void 0:e.touched)==null?void 0:N.categoriaId)&&((y=e==null?void 0:e.errors)==null?void 0:y.categoriaId)?r("label",{className:"mt-1 text-danger",children:(I=e==null?void 0:e.errors)==null?void 0:I.categoriaId}):null,t(o.Group,{className:"mb-3 form-group mt-2",children:[r(o.Label,{htmlFor:"exampleFormControlTextarea1",children:"NIF"}),r(o.Control,{type:"text",id:"nif",value:e.values.nif,name:"nif",onChange:e.handleChange}),((j=e==null?void 0:e.touched)==null?void 0:j.nif)&&((E=e==null?void 0:e.errors)==null?void 0:E.nif)?r("label",{className:"mt-1 text-danger",children:(S=e==null?void 0:e.errors)==null?void 0:S.nif}):null]})]}),t(A,{md:"6",className:"mb-3",children:[t(o.Group,{className:"mb-3 form-group mt-2",children:[r(o.Label,{className:"custom-file-input",children:"Carregar imagem"}),r(o.Control,{type:"file",id:"fotoUrl",accept:"image/png, image/jpg, image/jpeg, image/gif",name:"fotoUrl",onChange:a=>{var l;e.setFieldValue("fotoUrl",(l=a==null?void 0:a.currentTarget)==null?void 0:l.files)}}),((U=e==null?void 0:e.touched)==null?void 0:U.fotoUrl)&&((w=e==null?void 0:e.errors)==null?void 0:w.fotoUrl)?r("label",{className:"mt-1 text-danger",children:(q=e==null?void 0:e.errors)==null?void 0:q.fotoUrl}):null]}),t(o.Group,{className:"mb-3 form-group mt-2",children:[r(o.Label,{className:"custom-file-input",children:"Carregar imagem logo"}),r(o.Control,{type:"file",id:"logo",name:"logo",onChange:a=>{var l;e.setFieldValue("logo",(l=a==null?void 0:a.currentTarget)==null?void 0:l.files)}}),((v=e==null?void 0:e.touched)==null?void 0:v.logo)&&((D=e==null?void 0:e.errors)==null?void 0:D.logo)?r("label",{className:"mt-1 text-danger",children:(L=e==null?void 0:e.errors)==null?void 0:L.logo}):null]})]}),r("div",{className:"col-12",children:r(z,{type:"submit",disabled:H,children:"Cadastrar"})})]})})})]})})})});M.displayName="FuncionarioAdd";export{M as default};
